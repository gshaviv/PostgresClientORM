{"topicSections":[{"identifiers":["doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations\/init()"],"title":"Initializers"},{"identifiers":["doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations\/add(_:block:)","doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations\/perform()"],"title":"Instance Methods"}],"primaryContentSections":[{"declarations":[{"tokens":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"text":"Migrations","kind":"identifier"}],"platforms":["macOS"],"languages":["swift"]}],"kind":"declarations"},{"content":[{"text":"Overview","anchor":"overview","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"Create an instance of the Migrations class, add the various migrations steps with the "},{"type":"codeVoice","code":"add"},{"text":" function which receives a string with the migration step name and a block to execute. Finally call the ","type":"text"},{"type":"codeVoice","code":"perform"},{"text":" func to perform the migrations.","type":"text"},{"type":"text","text":" "},{"text":"The class will create a ","type":"text"},{"code":"_migrations","type":"codeVoice"},{"type":"text","text":" table if one does not exist to track which migrations were executed alrready and starts executing the migration steps in the order they were added starting from the first step that wasn’t executed yet. "},{"code":".update(:)","type":"codeVoice"},{"text":" the arugment being the new column type","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Example:"}]},{"syntax":"Swift","type":"codeListing","code":["  func migrate() async throws {","        let migrations = Migrations()","","        migrations.add(\"v1\") {","          try await table(\"t1\") {","              column(\"id\", type: .uuid).primaryKey()","              column(\"count\", type: .int).notNull()","          }","          .create()","        }","","        migrations.add(\"v2\") {","          try await table(\"t1\") {","               column(\"count\").drop()","               column(\"name, type: .string)","          }","          .update()","        }","","        try await migrations.perform()","  }"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The modifiers that can be applied on a table are: "},{"type":"codeVoice","code":".create()"},{"type":"text","text":", "},{"code":".drop()","type":"codeVoice"},{"type":"text","text":" and "},{"type":"codeVoice","code":".update()"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The modifiers that can be applied on a column in a table are: "},{"code":".primaryKey()","type":"codeVoice"},{"type":"text","text":", "},{"code":".notNull()","type":"codeVoice"},{"type":"text","text":", "},{"code":".defaultValue(:)","type":"codeVoice"},{"type":"text","text":" (with the default value given as the SQL string for that value,  "},{"type":"codeVoice","code":"rename(:)"},{"type":"text","text":" the argument being the new column name, "},{"code":".unique()","type":"codeVoice"},{"type":"text","text":" sets a unique contraint on the column, "},{"type":"codeVoice","code":"references(table:column:onDelete)"},{"type":"text","text":" make the column a foreign key to specified column in specified talbe. the onDelete argument is what to do on delete (e.g. cascade, or not allow, etc)"}]},{"type":"paragraph","inlineContent":[{"text":"To make a column auto increment give it type ","type":"text"},{"type":"codeVoice","code":".serial"},{"type":"text","text":" or "},{"code":".int64serial","type":"codeVoice"},{"text":" or ","type":"text"},{"code":".int16serial","type":"codeVoice"},{"text":". You can make it also a primary key to make it an auto incremanteed primary key.","type":"text"}]},{"name":"Note","type":"aside","style":"note","content":[{"inlineContent":[{"text":"The best practice is to use strings for the table and column names in the migrations which wil make them work also in case the entity they represent was modified or deleted.","type":"text"}],"type":"paragraph"}]}],"kind":"content"}],"abstract":[{"text":"Perform database migrations","type":"text"}],"kind":"symbol","hierarchy":{"paths":[["doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM"]]},"metadata":{"externalID":"s:17PostgresClientORM10MigrationsC","symbolKind":"class","fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"text":"Migrations","kind":"identifier"}],"roleHeading":"Class","modules":[{"name":"PostgresClientORM"}],"navigatorTitle":[{"kind":"identifier","text":"Migrations"}],"title":"Migrations","role":"symbol"},"identifier":{"url":"doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations","interfaceLanguage":"swift"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/postgresclientorm\/migrations"]}],"sections":[],"schemaVersion":{"major":0,"minor":3,"patch":0},"references":{"doc://PostgresClientORM/documentation/PostgresClientORM/Migrations/add(_:block:)":{"url":"\/documentation\/postgresclientorm\/migrations\/add(_:block:)","abstract":[{"text":"Add a migrations step","type":"text"}],"type":"topic","kind":"symbol","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"add"},{"kind":"text","text":"("},{"kind":"typeIdentifier","text":"String","preciseIdentifier":"s:SS"},{"kind":"text","text":", "},{"text":"block","kind":"externalParam"},{"text":": () ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"text":"Void","preciseIdentifier":"s:s4Voida","kind":"typeIdentifier"},{"text":")","kind":"text"}],"identifier":"doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations\/add(_:block:)","title":"add(_:block:)"},"doc://PostgresClientORM/documentation/PostgresClientORM/Migrations":{"url":"\/documentation\/postgresclientorm\/migrations","abstract":[{"text":"Perform database migrations","type":"text"}],"type":"topic","kind":"symbol","role":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Migrations","kind":"identifier"}],"navigatorTitle":[{"text":"Migrations","kind":"identifier"}],"title":"Migrations","identifier":"doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations"},"doc://PostgresClientORM/documentation/PostgresClientORM":{"abstract":[],"title":"PostgresClientORM","url":"\/documentation\/postgresclientorm","kind":"symbol","role":"collection","identifier":"doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM","type":"topic"},"doc://PostgresClientORM/documentation/PostgresClientORM/Migrations/perform()":{"kind":"symbol","identifier":"doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations\/perform()","fragments":[{"kind":"keyword","text":"func"},{"text":" ","kind":"text"},{"text":"perform","kind":"identifier"},{"text":"() ","kind":"text"},{"text":"async","kind":"keyword"},{"kind":"text","text":" "},{"text":"throws","kind":"keyword"}],"type":"topic","abstract":[{"text":"Perfrom all the migration steps that weren’t executed yet.","type":"text"}],"url":"\/documentation\/postgresclientorm\/migrations\/perform()","title":"perform()","role":"symbol"},"doc://PostgresClientORM/documentation/PostgresClientORM/Migrations/init()":{"kind":"symbol","identifier":"doc:\/\/PostgresClientORM\/documentation\/PostgresClientORM\/Migrations\/init()","fragments":[{"text":"init","kind":"identifier"},{"text":"()","kind":"text"}],"type":"topic","url":"\/documentation\/postgresclientorm\/migrations\/init()","abstract":[],"title":"init()","role":"symbol"}}}